<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · CounterMarking.jl</title><meta name="title" content="Home · CounterMarking.jl"/><meta property="og:title" content="Home · CounterMarking.jl"/><meta property="twitter:title" content="Home · CounterMarking.jl"/><meta name="description" content="Documentation for CounterMarking.jl."/><meta property="og:description" content="Documentation for CounterMarking.jl."/><meta property="twitter:description" content="Documentation for CounterMarking.jl."/><meta property="og:url" content="https://HolyLab.github.io/CounterMarking.jl/"/><meta property="twitter:url" content="https://HolyLab.github.io/CounterMarking.jl/"/><link rel="canonical" href="https://HolyLab.github.io/CounterMarking.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>CounterMarking.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Tutorial"><span>Tutorial</span></a></li><li><a class="tocitem" href="#Processing-data-with-the-GUI"><span>Processing data with the GUI</span></a></li><li><a class="tocitem" href="#Processing-manually"><span>Processing manually</span></a></li></ul></li><li><a class="tocitem" href="reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/HolyLab/CounterMarking.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/HolyLab/CounterMarking.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="CounterMarking"><a class="docs-heading-anchor" href="#CounterMarking">CounterMarking</a><a id="CounterMarking-1"></a><a class="docs-heading-anchor-permalink" href="#CounterMarking" title="Permalink"></a></h1><p><a href="https://github.com/HolyLab/CounterMarking.jl">CounterMarking</a> analyzes experiments on <a href="https://www.sciencedirect.com/science/article/pii/S0003347287800167">scent-marking in mice</a>, specifically images of urine countermarking visualized by the <a href="https://pubs.acs.org/doi/full/10.1021/jf030490p">ninhydrin reaction</a>:</p><p><img src="assets/Picture.png" alt="A ninhydrin-stained image"/></p><p>The yellow spot corresponds to a stimulus provided by the experimenter, and the small light-blue spots are deposited marks.</p><p>Tips on image quality:</p><ul><li>Put the stimulus near one of the four corners, keeping its location as consistent as possible between images</li><li>Ensure lighting is fairly uniform</li><li>Make sure that any extraneous marks (e.g., the black writing in the image above) are of a very different color from scent marks.</li><li>Ensure that all your images are of the same size (i.e., same number of pixels horizontally and vertically), even if there are some extra pixels on the edges of the image</li></ul><h2 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h2><h3 id="Installation-and-setup-(one-time-setup)"><a class="docs-heading-anchor" href="#Installation-and-setup-(one-time-setup)">Installation and setup (one time setup)</a><a id="Installation-and-setup-(one-time-setup)-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-and-setup-(one-time-setup)" title="Permalink"></a></h3><p>There are several ways to organize your data, but one recommended approach is to have a parent &quot;project&quot; folder, and then store images collected on different days in subfolders named by date:</p><pre><code class="language-sh hljs">MyCounterMarkingFolder
  Project.toml
  2025-03-15/
  2025-03-17/
  ...</code></pre><p>We&#39;ll create the <code>Project.toml</code> for running the analysis. From the command line within <code>MyCounterMarkingFolder</code>, the steps below will:</p><ul><li>start Julia</li><li>get into <code>pkg&gt;</code> mode</li><li>activate a new project</li><li>install the packages you&#39;ll use</li></ul><p>Here are the steps, starting from the OS command line:</p><pre><code class="nohighlight hljs">MyCounterMarkingFolder$ julia
&lt;banner shows up&gt;

julia&gt; ]    # this enters pkg mode
pkg&gt; activate .

pkg&gt; add CounterMarking ImageView Glob FileIO ImageIO</code></pre><p>This should create the <code>Project.toml</code> file in <code>MyCounterMarkingFolder</code>. If this succeeds, you shouldn&#39;t have to do this again.</p><p>From this point on, start Julia like this:</p><pre><code class="language-sh hljs">MyCounterMarkingFolder$ julia --project</code></pre><p>and it will automatically &quot;activate&quot; this project and you&#39;ll have access to all those packages.</p><div class="admonition is-success" id="Tip-12b4b414fdd9c98"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-12b4b414fdd9c98" title="Permalink"></a></header><div class="admonition-body"><p>If you ever need to update the packages (e.g., to get any improvements to <code>CounterMarking.jl</code>), you can update packages with <code>pkg&gt; up</code>. See the <a href="https://pkgdocs.julialang.org/v1/getting-started/">Pkg documentation</a> for more information.</p></div></div><h2 id="Processing-data-with-the-GUI"><a class="docs-heading-anchor" href="#Processing-data-with-the-GUI">Processing data with the GUI</a><a id="Processing-data-with-the-GUI-1"></a><a class="docs-heading-anchor-permalink" href="#Processing-data-with-the-GUI" title="Permalink"></a></h2><h3 id="Running-the-GUI"><a class="docs-heading-anchor" href="#Running-the-GUI">Running the GUI</a><a id="Running-the-GUI-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-GUI" title="Permalink"></a></h3><p>From within <code>MyCounterMarkingFolder</code> created above, start Julia like this:</p><pre><code class="language-sh hljs">MyCounterMarkingFolder$ julia --project</code></pre><p>Then load the packages:</p><pre><code class="nohighlight hljs">julia&gt; using CounterMarking, Glob</code></pre><p>Then specify the images you want to process:</p><pre><code class="nohighlight hljs">julia&gt; gui(&quot;results_file_name&quot;, glob&quot;Picture*.png&quot;)</code></pre><p>This will save your results to <code>&quot;results_file_name.xlsx&quot;</code> and <code>&quot;results_file_name.jld2&quot;</code>. The syntax <code>glob&quot;pattern&quot;</code> means &quot;all files that match this pattern&quot;, where <code>*</code> means &quot;one or more characters&quot;. See <a href="https://www.malikbrowne.com/blog/a-beginners-guide-glob-patterns/">this tutorial</a> for more information about glob syntax. Alternatively, you can supply a list of files:</p><pre><code class="nohighlight hljs">julia&gt; gui(&quot;results_file_name&quot;, [&quot;PictureA.png&quot;, &quot;mouse7.png&quot;])</code></pre><p>Additionally, you can supply a calibration image to improve segmentation by correcting for uneven illumination.</p><p><img src="assets/blurred_calibration.png" alt="An image to be used for calibration"/></p><pre><code class="nohighlight hljs">julia&gt; gui(&quot;results_file_name&quot;, [&quot;PictureA.png&quot;, &quot;mouse7.png&quot;]; background_path=&quot;calibration_image.png&quot;)</code></pre><p>There are a few more keyword arguments that might be useful:</p><ul><li><code>crop_top</code>, <code>crop_bottom</code>, <code>crop_left</code>, and <code>crop_right</code> specify a number of pixels to be cropped from images along each side</li><li><code>expectedloc</code> specifies the expected location of the stimulus spot in pixels (after cropping)</li></ul><pre><code class="nohighlight hljs">julia&gt; gui(&quot;results_file_name&quot;, glob&quot;Picture*.png&quot;; 
            background_path=&quot;calibration_image.png,
            crop_top=93,
            crop_bottom=107,
            crop_left=55,
            crop_right=45,    
            expectedloc=[1600,3333]
        )</code></pre><p>However you launch it, you should see something like this:</p><p><img src="assets/gui.png" alt="GUI"/></p><p>On the top is the raw image. On the bottom is the segmented image; you should visually compare the two to check whether you&#39;re pleased with the quality of the segmentation.</p><p>If the default segmentation doesn&#39;t look quite right, try adjusting the Color Similarity Threshold value using the buttons at the bottom of the GUI. (If you can&#39;t obtain a segmentation that you&#39;re happy with, click &quot;Skip&quot; to omit that file from analysis.)</p><p>If you like the segmentation, your tasks are:</p><ul><li>click on all the checkboxes with colors that correspond to urine spots. You&#39;ll notice that the stimulus spot is pre-clicked (you can correct its choice if it didn&#39;t pick correctly). Most of the time there will be only one you need to check, but you can click more than one. In this example image, all the urine spots are marked red, so you&#39;d check the box that has the red border. Leave the stimulus spot checked, too.</li><li>click &quot;Done &amp; Next&quot; to advance to the next image in the sequence</li></ul><p>After it finishes cycling through all the images, it will save your results and close the window.</p><h3 id="Summarizing-the-results:-create-a-&quot;density-map&quot;-of-marks-across-multiple-images"><a class="docs-heading-anchor" href="#Summarizing-the-results:-create-a-&quot;density-map&quot;-of-marks-across-multiple-images">Summarizing the results: create a &quot;density map&quot; of marks across multiple images</a><a id="Summarizing-the-results:-create-a-&quot;density-map&quot;-of-marks-across-multiple-images-1"></a><a class="docs-heading-anchor-permalink" href="#Summarizing-the-results:-create-a-&quot;density-map&quot;-of-marks-across-multiple-images" title="Permalink"></a></h3><p>If you have many images collected under the same conditions (e.g., with different subject animals but the same stimuli), you can effectively overlay the entire collection of images. For this demo, it&#39;s assumed that <code>&quot;results_file_name.jld2&quot;</code> is one of the files output by the GUI.</p><pre><code class="nohighlight hljs">julia&gt; using CounterMarking, ImageView   # load packages (if this is a fresh session)

julia&gt; count = density_map(&quot;results_file_name.jld2&quot;);

julia&gt; dmap = count ./ maximum(count);

julia&gt; dct = imshow(dmap);</code></pre><div class="admonition is-success" id="Tip-2cdc44b3c7f755a4"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-2cdc44b3c7f755a4" title="Permalink"></a></header><div class="admonition-body"><p><code>density_map</code> requires that most or all of your images are of the same size.</p></div></div><h2 id="Processing-manually"><a class="docs-heading-anchor" href="#Processing-manually">Processing manually</a><a id="Processing-manually-1"></a><a class="docs-heading-anchor-permalink" href="#Processing-manually" title="Permalink"></a></h2><h3 id="Step-1:-start-Julia-with-the-right-project"><a class="docs-heading-anchor" href="#Step-1:-start-Julia-with-the-right-project">Step 1: start Julia with the right project</a><a id="Step-1:-start-Julia-with-the-right-project-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-start-Julia-with-the-right-project" title="Permalink"></a></h3><p>From within <code>MyCounterMarkingFolder</code> created above, start Julia like this:</p><pre><code class="language-sh hljs">MyCounterMarkingFolder$ julia --project</code></pre><h3 id="Step-2:-load-the-packages-you&#39;ll-need"><a class="docs-heading-anchor" href="#Step-2:-load-the-packages-you&#39;ll-need">Step 2: load the packages you&#39;ll need</a><a id="Step-2:-load-the-packages-you&#39;ll-need-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-load-the-packages-you&#39;ll-need" title="Permalink"></a></h3><p>From inside Julia, load the packages:</p><pre><code class="nohighlight hljs">julia&gt; using CounterMarking, ImageView, FileIO</code></pre><p>CounterMarking is this package, used to perform and organize the analysis. <a href="https://github.com/JuliaImages/ImageView.jl">ImageView</a> is an image display tool. <a href="https://github.com/JuliaIO/FileIO.jl">FileIO</a> loads many different file formats, including images.</p><h3 id="Step-3:-load-a-test-image"><a class="docs-heading-anchor" href="#Step-3:-load-a-test-image">Step 3: load a test image</a><a id="Step-3:-load-a-test-image-1"></a><a class="docs-heading-anchor-permalink" href="#Step-3:-load-a-test-image" title="Permalink"></a></h3><p>If you want to use an image in one of the subfolders, use something like</p><pre><code class="nohighlight hljs">julia&gt; img = load(&quot;2025-03-15/picture1.png&quot;);</code></pre><p>You&#39;ll need to replace the material inside quotes with the actual path and filename of your image.</p><p>Alternately, if you want to use the test image that comes with CounterMarking.jl, do the following:</p><pre><code class="nohighlight hljs">julia&gt; img = load(joinpath(pkgdir(CounterMarking), &quot;docs&quot;, &quot;src&quot;, &quot;assets&quot;, &quot;Picture.png&quot;));</code></pre><h3 id="Step-4:-visualize-the-image"><a class="docs-heading-anchor" href="#Step-4:-visualize-the-image">Step 4: visualize the image</a><a id="Step-4:-visualize-the-image-1"></a><a class="docs-heading-anchor-permalink" href="#Step-4:-visualize-the-image" title="Permalink"></a></h3><p>It&#39;s usually a good idea to visually check that what you&#39;re working with makes sense:</p><pre><code class="nohighlight hljs">julia&gt; dct = imshow(img);</code></pre><p>Note that as you move your mouse cursor over the image, a little text box in the lower left updates with the position and information about the color of the pixel under your cursor. That can occasionally be handy, especially for checking locations of spots.</p><p>If all looks as expected, you can close the window.</p><h3 id="Step-5:-segment-the-image"><a class="docs-heading-anchor" href="#Step-5:-segment-the-image">Step 5: segment the image</a><a id="Step-5:-segment-the-image-1"></a><a class="docs-heading-anchor-permalink" href="#Step-5:-segment-the-image" title="Permalink"></a></h3><p>We&#39;ll split this image into different regions:</p><pre><code class="nohighlight hljs">julia&gt; seg = segment_image(img)
Pruning segments smaller than 50 pixels
Segmented Image with:
  labels map: 1220×2441 Matrix{Int64}
  number of labels: 153

julia&gt; dct = randshow(img, seg);</code></pre><p>After the second command, <a href="reference/#CounterMarking.randshow"><code>randshow</code></a>, you&#39;ll see two images: the original at the top, and the &quot;segmented&quot; image below. This displays the different segments (regions) using a randomly-chosen color, which can be handy for checking how well the analysis did in identifying separate spots. You can alternatively use <a href="reference/#CounterMarking.meanshow"><code>meanshow</code></a> to show each segment using the average color of all pixels in that segment.</p><p>If you Ctrl-click and drag on the image, you&#39;ll zoom in on both images. This can be handy for inspecting fine details. Ctrl-double-click takes you back to the full view.</p><div class="admonition is-success" id="Tip-991d47806c5a9ce5"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-991d47806c5a9ce5" title="Permalink"></a></header><div class="admonition-body"><p>If you don&#39;t like how <a href="reference/#CounterMarking.segment_image-Tuple{AbstractMatrix{&lt;:ColorTypes.Color}}"><code>segment_image</code></a> performed, read its documentation to learn about some of the options you have for controlling it.</p></div></div><h3 id="Step-6:-save-the-spots-to-an-Excel-file"><a class="docs-heading-anchor" href="#Step-6:-save-the-spots-to-an-Excel-file">Step 6: save the spots to an Excel file</a><a id="Step-6:-save-the-spots-to-an-Excel-file-1"></a><a class="docs-heading-anchor-permalink" href="#Step-6:-save-the-spots-to-an-Excel-file" title="Permalink"></a></h3><p>The columns marked &quot;raw&quot; correspond to pixel locations in the original image; the columns marked &quot;UL&quot; come from flipping the image to place the stimulus spot in the Upper Left of the image. This way of &quot;standardizing&quot; the location makes certain analyses easier.</p><pre><code class="nohighlight hljs">julia&gt; writexlsx(&quot;mydata.xlsx&quot;, seg)</code></pre><p>Optionally specify a full directory path, e.g.,</p><pre><code class="nohighlight hljs">julia&gt; writexlsx(raw&quot;C:\Users\me\somefolder\mydata.xlsx&quot;, seg)</code></pre><p>(You don&#39;t need <code>raw</code> on Linux or Mac, but it is helpful on Windows.)</p><h3 id="Step-7:-process-a-whole-directory-of-images-at-once"><a class="docs-heading-anchor" href="#Step-7:-process-a-whole-directory-of-images-at-once">Step 7: process a whole directory of images at once</a><a id="Step-7:-process-a-whole-directory-of-images-at-once-1"></a><a class="docs-heading-anchor-permalink" href="#Step-7:-process-a-whole-directory-of-images-at-once" title="Permalink"></a></h3><p>If you have many images in one folder, you can process them all using a single command:</p><pre><code class="nohighlight hljs">julia&gt; process_images(&quot;2025-03-15/results.xlsx&quot;, &quot;2025-03-15/*.png&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 5 September 2025 14:44">Friday 5 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
